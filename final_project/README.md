# Платформа учета рабочего времени ассистентов

Интерактивная веб-платформа для ведения учета рабочего времени ассистентов с поддержкой различных ролей и интеграцией с Битрикс24.

## Возможности

### Основной функционал
- ✅ Учет рабочих смен для разных ролей (ассистент, модель, администратор, выездная съемка)
- ✅ Автоматический расчет заработной платы по почасовым ставкам
- ✅ Календарное отображение рабочих дней
- ✅ Детальные отчеты по сотрудникам и периодам
- ✅ Экспорт данных в Excel/CSV формат

### Интеграция с Битрикс24
- ✅ Синхронизация сотрудников из Битрикс24
- ✅ Создание задач на основе табелей
- ✅ Автоматическое создание сделок по результатам работы
- ✅ Отправка отчетов в проекты

### Система авторизации
- ✅ Разграничение прав доступа (администратор, менеджер, сотрудник)
- ✅ Безопасное хранение паролей
- ✅ Сессионная авторизация

## Структура проекта

```
timesheet-platform/
├── database.sql              # Структура базы данных
├── backend/
│   ├── config/
│   │   └── database.php      # Настройки подключения к БД
│   ├── api/
│   │   └── timesheet.php     # Основной API
│   ├── auth/
│   │   └── login.php         # Система авторизации
│   ├── bitrix/
│   │   └── integration.php   # Интеграция с Битрикс24
│   └── export/
│       └── excel.php         # Экспорт в Excel
├── frontend/
│   ├── index.html           # Главная страница
│   └── script.js            # JavaScript функционал
└── README.md
```

## Установка и настройка

### 1. Требования
- PHP 7.4+
- MySQL 5.7+/MariaDB 10.2+
- Веб-сервер (Apache/Nginx)
- Модуль PHP cURL (для интеграции с Битрикс24)

### 2. Установка базы данных
```sql
-- Создание базы данных и таблиц
mysql -u root -p < database.sql
```

### 3. Настройка подключения к БД
Отредактируйте файл `backend/config/database.php`:
```php
private $host = 'localhost';
private $db_name = 'timesheet_platform';
private $username = 'your_username';
private $password = 'your_password';
```

### 4. Настройка веб-сервера
Разместите файлы на веб-сервере и настройте корневую папку на `frontend/`.

### 5. Создание первого пользователя
```php
// Выполните этот код для создания администратора
include 'backend/auth/login.php';
$auth = new AuthSystem();
$result = $auth->createUser('admin', 'password123', 'admin');
```

## Интеграция с Битрикс24

### Настройка вебхуков
1. В Битрикс24 перейдите в "Разработчикам" → "Другое" → "Входящий вебхук"
2. Создайте новый вебхук с правами:
   - CRM (crm)
   - Пользователи (user)
   - Задачи (task)
   - Социальная сеть (sonet_group)

3. Обновите URL в `backend/bitrix/integration.php`:
```php
$this->bitrix_webhook_url = 'https://your-portal.bitrix24.ru/rest/1/your_webhook_key/';
```

### Использование интеграции
- **Синхронизация сотрудников**: Автоматический импорт пользователей из Битрикс24
- **Отправка табелей**: Создание задач в Битрикс24 с отчетами о рабочем времени
- **Создание сделок**: Автоматическое создание сделок на сумму заработной платы

## API документация

### Основные эндпоинты

#### Сотрудники
- `GET /api/timesheet.php/employees` - Список сотрудников
- `POST /api/timesheet.php/employee` - Добавление сотрудника

#### Рабочие смены
- `POST /api/timesheet.php/shift` - Добавление смены
- `GET /api/timesheet.php/timesheet?start=YYYY-MM-DD&end=YYYY-MM-DD` - Табель за период

#### Отчеты
- `GET /api/timesheet.php/report?year=YYYY&month=MM` - Месячный отчет

#### Экспорт
- `GET /export/excel.php?action=timesheet&start=YYYY-MM-DD&end=YYYY-MM-DD` - Экспорт табеля
- `GET /export/excel.php?action=calendar&year=YYYY&month=MM` - Календарный табель

#### Битрикс24
- `POST /bitrix/integration.php` с action:
  - `sync_employees` - Синхронизация сотрудников
  - `send_timesheet` - Отправка табеля как задачу
  - `create_deal` - Создание сделки

## Использование

### Ввод данных
1. Откройте веб-интерфейс
2. На вкладке "Ввод данных" выберите сотрудника, роль, дату и количество часов
3. При необходимости добавьте примечания
4. Нажмите "Добавить"

### Просмотр табеля
1. Перейдите на вкладку "Табель"
2. Выберите период
3. Нажмите "Показать"
4. Для экспорта нажмите "Excel"

### Отчеты
1. На вкладке "Отчеты" выберите год и месяц
2. Нажмите "Показать"
3. Получите сводную информацию по всем сотрудникам

### Управление сотрудниками
1. На вкладке "Сотрудники" добавьте новых сотрудников
2. Укажите ФИО, email и телефон
3. Данные будут доступны для выбора при вводе смен

## Безопасность

- Все пароли хешируются с использованием PHP password_hash()
- API защищено от SQL-инъекций с помощью подготовленных запросов
- Сессии используются для авторизации
- CORS настроен для безопасного доступа

## Расширение функционала

Платформа легко расширяется:
- Добавление новых ролей в таблице `roles`
- Создание дополнительных отчетов
- Интеграция с другими CRM системами
- Мобильное приложение через REST API

## Поддержка

При возникновении вопросов или проблем:
1. Проверьте логи веб-сервера и PHP
2. Убедитесь в корректности настроек БД
3. Проверьте права доступа к файлам

## Лицензия

Проект предоставляется "как есть" для внутреннего использования.